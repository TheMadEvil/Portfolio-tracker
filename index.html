<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Investment Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
    }
    .person {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
    }
    .editable {
      padding: 2px 4px;
      border: 1px dashed #ccc;
      cursor: text;
    }
    .editable:focus {
      outline: none;
      background: #f5f5f5;
    }
    .total {
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h2>Investment Portfolio Tracker</h2>
<div class="container" id="dashboard"></div>
<p><button onclick="addPerson()">âž• Add Person</button></p>
<canvas id="diversificationChart" width="600" height="300"></canvas>

<script>
let data = JSON.parse(localStorage.getItem("portfolioData")) || [
  {
    name: "You",
    funds: [
      { name: "Axis Liquid Fund", amount: 1026 },
      { name: "Nippon Silver ETF FoF", amount: 3786 },
      { name: "Nippon Large Cap", amount: 2914 },
      { name: "Invesco PSU ETF", amount: 2500 },
      { name: "Parag Parikh Flexi Cap", amount: 2500 }
    ]
  },
  {
    name: "Spouse",
    funds: [
      { name: "SBI Contra Regular", amount: 16247 },
      { name: "SBI Large & Mid Regular", amount: 8371.95 },
      { name: "SBI Small Cap Regular", amount: 16428 }
    ]
  }
];

function render() {
  const dashboard = document.getElementById("dashboard");
  dashboard.innerHTML = "";

  let chartLabels = [];
  let chartData = [];

  data.forEach((person, i) => {
    const wrapper = document.createElement("div");
    wrapper.className = "person";

    const personName = document.createElement("h3");
    personName.contentEditable = true;
    personName.className = "editable";
    personName.innerText = person.name;
    personName.onblur = () => {
      data[i].name = personName.innerText;
      save();
    };
    wrapper.appendChild(personName);

    let total = 0;
    person.funds.forEach((fund, j) => {
      const p = document.createElement("p");

      const nameSpan = document.createElement("span");
      nameSpan.contentEditable = true;
      nameSpan.className = "editable";
      nameSpan.innerText = fund.name;
      nameSpan.onblur = () => {
        data[i].funds[j].name = nameSpan.innerText;
        save();
        renderChart();
      };

      const amtSpan = document.createElement("span");
      amtSpan.contentEditable = true;
      amtSpan.className = "editable";
      amtSpan.innerText = fund.amount;
      amtSpan.onblur = () => {
        const val = parseFloat(amtSpan.innerText);
        data[i].funds[j].amount = isNaN(val) ? 0 : val;
        save();
        render();
        renderChart();
      };

      p.appendChild(document.createTextNode("ðŸ·ï¸ "));
      p.appendChild(nameSpan);
      p.appendChild(document.createTextNode(" â€” â‚¹"));
      p.appendChild(amtSpan);

      wrapper.appendChild(p);

      total += parseFloat(fund.amount);
      chartLabels.push(`${person.name} - ${fund.name}`);
      chartData.push(fund.amount);
    });

    const totalP = document.createElement("p");
    totalP.className = "total";
    totalP.innerText = `Total: â‚¹${total.toLocaleString()}`;
    wrapper.appendChild(totalP);

    dashboard.appendChild(wrapper);
  });

  renderChart(chartLabels, chartData);
}

function addPerson() {
  const newPerson = {
    name: "New Person",
    funds: [
      { name: "New Fund", amount: 0 }
    ]
  };
  data.push(newPerson);
  save();
  render();
}

function save() {
  localStorage.setItem("portfolioData", JSON.stringify(data));
}

function renderChart(labels, values) {
  const ctx = document.getElementById("diversificationChart").getContext("2d");
  if (window.chartInstance) window.chartInstance.destroy();
  window.chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Investment Amount (â‚¹)',
        data: values,
        backgroundColor: 'rgba(54, 162, 235, 0.5)',
        borderColor: 'rgba(54, 162, 235, 1)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          callbacks: {
            label: ctx => `â‚¹${ctx.raw.toLocaleString()}`
          }
        }
      },
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
}

render();
</script>
</body>
</html>
